<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="null">
    <meta name="keyword" content="null">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        GeoSpider分布式爬虫 - null
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> enjoy everyday. </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/images/favicon.ico">
        </div>
        <div class="name">
            <i>WANG Haomao</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li>
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li>
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li>
                <a href="/archive">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li>
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#主要功能"><span class="toc-text">主要功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-数据抓取"><span class="toc-text">1. 数据抓取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-爬虫状态监控"><span class="toc-text">2. 爬虫状态监控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-数据分析"><span class="toc-text">3. 数据分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设计思路"><span class="toc-text">设计思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-电商类网站结构化"><span class="toc-text">1. 电商类网站结构化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1、导航栏抓取"><span class="toc-text">1.1、导航栏抓取</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#设计思路概述"><span class="toc-text">设计思路概述</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#方法概述"><span class="toc-text">方法概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2、导航链接解析（抓取详细页面链接"><span class="toc-text">1.2、导航链接解析（抓取详细页面链接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3、解析商品列表页面"><span class="toc-text">1.3、解析商品列表页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4、商品详细页面分析"><span class="toc-text">1.4、商品详细页面分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-新闻博客类网站结构化"><span class="toc-text">2. 新闻博客类网站结构化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-分布式与多进程概述"><span class="toc-text">3. 分布式与多进程概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-错误恢复机制"><span class="toc-text">4. 错误恢复机制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#主要框架与依赖"><span class="toc-text">主要框架与依赖</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input">
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i> enjoy everyday. </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        GeoSpider分布式爬虫
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2017-11-13 12:54:32</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#Projects" title="Projects">Projects</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>

    </div>
    <div class="post-content ">
        <p><strong>GeoSpider</strong> 是一款适用于结构化抓取新闻博客、电商类网站的分布式爬虫。系统可对新闻网站，绝大多数的博客和电商网站进行数据自动摘录。采用多进程辅佐分布式的并发方式，提高采集效率。总体使用Psutil进行进程、Scrapy-Redis作分布式与管理、MonoDB作数据存储。爬虫任务可设定启动时间、选择主机IP等。兴趣爱好与参加中国软件杯。</p>
<p>视频链接 <a href="https://www.bilibili.com/video/av12055194/?from=search&amp;seid=13360983049365681598" target="_blank" rel="noopener">https://www.bilibili.com/video/av12055194/?from=search&amp;seid=13360983049365681598</a></p>
<h2 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h2><p>本节主要介绍 <strong>GeoSpider</strong> 的基本功能，包括数据的抓取、状态监控和简单的数据分析等等</p>
<h3 id="1-数据抓取"><a href="#1-数据抓取" class="headerlink" title="1. 数据抓取"></a>1. 数据抓取</h3><p> <strong>GeoSpider</strong> 是一个为爬虫系统，旨在高效、准确地抓取网络页面中的数据</p>
<h3 id="2-爬虫状态监控"><a href="#2-爬虫状态监控" class="headerlink" title="2. 爬虫状态监控"></a>2. 爬虫状态监控</h3><p>使用Graphite监控所有爬虫任务，能够监控到爬虫的下载速率、爬去数据数量等，并绘制成图像显示出来。<br>爬虫启动后，每台主机会启动一个监听进程来监听定时进程，将即将到达结束时间的进程终止。</p>
<h3 id="3-数据分析"><a href="#3-数据分析" class="headerlink" title="3. 数据分析"></a>3. 数据分析</h3><p>1.堆叠条形图：统计正在进行爬虫任务的数量信息，分别统计电商爬虫、新闻爬虫、博客爬虫分别运行、暂停、等待、故障的数量。<br>2.饼状图：统计历史爬虫（已经结束的爬虫）电商、新闻、博客的数量比例。<br>3.阶梯折线图：统计最近一周时间电商、新闻、博客爬虫任务的数量走向。<br>3.雷达图：最有价值的图。统计当前每台机器的爬虫进程数量，用户可以很清晰的获知爬虫任务在每台机器上的分布情况，因此可以分析出每台机器的负荷，为用户下次发布任务提供指导。</p>
<h2 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h2><h3 id="1-电商类网站结构化"><a href="#1-电商类网站结构化" class="headerlink" title="1. 电商类网站结构化"></a>1. 电商类网站结构化</h3><h4 id="1-1、导航栏抓取"><a href="#1-1、导航栏抓取" class="headerlink" title="1.1、导航栏抓取"></a>1.1、导航栏抓取</h4><p>返回值：列表（标签:url），例如：（裙子:<a href="http://www.xxx.com/qunzi）" target="_blank" rel="noopener">http://www.xxx.com/qunzi）</a></p>
<h5 id="设计思路概述"><a href="#设计思路概述" class="headerlink" title="设计思路概述"></a>设计思路概述</h5><p>主要思想是是渐进的特征提取，以关键字聚类作为辅助。</p>
<p>关键字聚类：预先设计好电商网站的导航栏关键字，其次对Web网页中某个结构进行多次匹配，计算得分，得分越高聚类程度越强，选优者作为导航栏，存在一定误差和少量不足。</p>
<h4 id="方法概述"><a href="#方法概述" class="headerlink" title="方法概述"></a>方法概述</h4><p>以下方法按照顺序执行，上一个方法不成功则进行下一个，理论依据暂不明确。<br>通过“所有商品分类”、“商品分类”、“分类”等关键字的特征值提取，获取大分类页面。若该步成功，跳转到 xx 步继续执行<br>提取特征：class = <em>nav</em>，并进行关键词匹配<br>提取特征：tag_name = ul，并进行关键词匹配<br>方法1.2.2与方法1.2.3提取获得的结果将进行再一次的导航栏抓取，由于二级页面可能存在大分类页面或是母标签的扩展标签，尽可能的多提取标签与url。<br>上述方法都不适用（暂未遇到），拟计划提醒消息，手动输入class或id或其他特征值进行抓取</p>
<p>【注】:获取大分类所有标签（1.1扩展）<br>主要思想：标签树序列化，聚类后获取量值最优解，选作结果集</p>
<p>标签树序列化后对形态：html/body/div/div/ul/li/a</p>
<h4 id="1-2、导航链接解析（抓取详细页面链接"><a href="#1-2、导航链接解析（抓取详细页面链接" class="headerlink" title="1.2、导航链接解析（抓取详细页面链接"></a>1.2、导航链接解析（抓取详细页面链接</h4><p>（此模块可归为第一步，由于相对复杂，单独列项）<br>对于第一步（导航栏抓取）拿到的 (名词:url)列表，称为url_list，进行第一遍遍历。<br>分支一<br>如果名词（关键字）在url中出现，就可以做关键词查询操作（例如我们平常在购物网站购物时做的那样）</p>
<p>（此处需要对该名词的选择还是比较考究的，最好选择有list/search字样的url，选择不慎可能出现大量url没有商品信息的问题。）</p>
<p>1.1 选择较优的url，简称为orignal_url，并对url做如下操作<br>步骤一：用&amp;分割, split(‘&amp;’)<br>步骤二：拼接字符串，获得包括关键字在内的近-最简的url，此处需要对url进行拼接试探。获取简化        后的url，以下简称simple_url。<br>步骤三：对 simple_url 进行解析，包括翻页信息、关键字替换信息等等。<br>步骤四：对url_list进行第二遍遍历，将里面关键字在simple_url中替换，得到res_url_list</p>
<p>拼接试探：先获取包括url在内的最简化的url，简称为simple_url。利用request等方法测试其html数量上与orignal_url用request获得的数量，若减少量巨大，接上其他由&amp;分割的字串，继续测试。</p>
<p>分支二<br>如果名词（关键词）始终没有在url中出现（或不符合要求）<br>直接默认这些url为商品列表，直接规划为res_url_list</p>
<h4 id="1-3、解析商品列表页面"><a href="#1-3、解析商品列表页面" class="headerlink" title="1.3、解析商品列表页面"></a>1.3、解析商品列表页面</h4><p>【注】：在遍历之前最好对分支二得到的res_url_list做一遍聚类处理，对每一类进行一遍结构化</p>
<p>进行具体结构化，获取商品的详细页面链接，思路如下：<br>1、判断该网址中的存储类型，以此选择解析方法：<br>通过html中的字符串数量判断，共分为以下3中解析方式：<br>1.1、JSON解析方法（request），主要商品数据在JSON中<br>1.2、标签解析方法（request），数据不在Json中，在标签中可直接提取<br>1.3、标签解析方法（webdriver），数据不在Json中，通过request无法获得，借用webdriver获取标签</p>
<p>上述步骤主要获取商品详细页面的url，并进行一定的提取，例如价格、描述等等</p>
<h4 id="1-4、商品详细页面分析"><a href="#1-4、商品详细页面分析" class="headerlink" title="1.4、商品详细页面分析"></a>1.4、商品详细页面分析</h4><p>通过对关键词的提取，预先设置关键词的先后顺序，不断匹配html标签中的信息，结构化出内容。例如匹配商品价格时，首先查找</p>
<h3 id="2-新闻博客类网站结构化"><a href="#2-新闻博客类网站结构化" class="headerlink" title="2. 新闻博客类网站结构化"></a>2. 新闻博客类网站结构化</h3><p>新闻博客抽取算法是采用基于行块分布，或者叫基于文本密度的方法，并在该方法上再做了优化，在我们自己设计的测试下，准确率达到95以上。<br>对于新闻博客类网站，一般文字内容最集中的区域就是正文。但是也不尽然，有些新闻正文很短，而导航栏内容信息很多。<br>首先，过滤噪声标签等的影响。采用正则过滤掉ul、script、style、注释等内容，记下该内容，然后过滤所有标签，再标记该内容。<br>然后定义k行为一个行块，去掉空格的长度为行块长度。根据行块分布找出最密集的区域则为正文内容。<br>该正文内容已经基本正确，但是如果该正文区域下方或前方不远处出现小部分无关内容，也会计入正文内容，导致有稍许误差。<br>为了提高准确率，在去掉噪声的网页中全文搜索包含在已提取的正文中的块信息，一般为“p“标签，再计算得到该标签的父节点。<br>将所有获得的父节点存储下来，出现次数最多的父节点标签即为包含整个正文区域的标签。直接从该标签提取文字即为正文。<br>该过程失败则使用之前提取的正文，成功则使用该区域提取的文字作为正文。</p>
<h3 id="3-分布式与多进程概述"><a href="#3-分布式与多进程概述" class="headerlink" title="3. 分布式与多进程概述"></a>3. 分布式与多进程概述</h3><p>各机器之间的通信借助Redis的订阅发布功能，订阅了爬虫频道的从机才能够收到主机的信息，解析主机的命令，然后控制机器自己上面的爬虫程序。<br>主机根据用户需求，向指定的从机发送控制爬虫的命令（启动、暂停、唤醒、终止）和该爬虫任务需要启动的进程数量。从机通过控制进程来控制爬虫。</p>
<h3 id="4-错误恢复机制"><a href="#4-错误恢复机制" class="headerlink" title="4. 错误恢复机制"></a>4. 错误恢复机制</h3><p>机器监听到本机上的爬虫由于异常即将终止程序时，该机器会清空本机的所有任务，根据任务记录启动新的爬虫程序继续之前未完成的任务。<br>已爬取过的链接由于已经存储下来，所有重新启动爬虫后会进行URL判重，不会抓取到重复的链接。</p>
<h2 id="主要框架与依赖"><a href="#主要框架与依赖" class="headerlink" title="主要框架与依赖"></a>主要框架与依赖</h2><blockquote>
<ul>
<li>Scrapy</li>
<li>发布日记，杂文，所见所想</li>
<li>撰写发布技术文稿（代码支持）</li>
<li>撰写发布学术论文（LaTeX 公式支持）</li>
</ul>
</blockquote>

        
        <br>
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank" href="https://github.com/WangHaomao">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span>/</span>
        
        <span><a href="https://github.com/wanghaomao">Haomao&#39;s Github</a></span>
        <span>/</span>
        
        <span><a href="#">It helps SEO</a></span>
        <span>/</span>
        
    </p>
    
    <p>Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
